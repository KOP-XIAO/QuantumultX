/** 
â˜‘ï¸ èµ„æºè§£æå™¨ Â©ğ’ğ¡ğšğ°ğ§  âŸ¦2021-11-12 10:15âŸ§
----------------------------------------------------------
ğŸ›  å‘ç° ğğ”ğ† è¯·åé¦ˆ: @ShawnKOP_bot
â›³ï¸ å…³æ³¨ ğŸ†ƒğŸ…¶ ç›¸å…³é¢‘é“: https://t.me/QuanX_API
ğŸ—£ ğŸ†ƒğŸ„·ğŸ„°ğŸ„½ğŸ„ºğŸ…‚ ğŸ†ƒğŸ„¾  @Jamie CHIEN, @M**F**, @c0lada, @Peng-YM, @vinewx, @love4taylor, @shadowdogy 

ğŸ¤– ä¸»è¦åŠŸèƒ½: 
â¶ å°†å…¶å®ƒæ ¼å¼çš„âŸ¦æœåŠ¡å™¨è®¢é˜…âŸ§è§£ææˆ ğğ®ğšğ§ğ­ğ®ğ¦ğ®ğ¥ğ­ ğ— æ ¼å¼
â˜‘ï¸ æ”¯æŒ ğ•2ğ«ğšğ²ğ/ğ—¦ğ—¦(ğ—¥/ğ——)/ğ—›ğ—§ğ—§ğ—£(ğ—¦)/ğ—§ğ—¿ğ—¼ğ—·ğ—®ğ—»/ğ—¤ğ˜‚ğ—®ğ—»ğ˜ğ˜‚ğ—ºğ˜‚ğ—¹ğ˜(ğ—«)/ğ—¦ğ˜‚ğ—¿ğ—´ğ—²/ğ‚ğ¥ğšğ¬ğ¡/ğ’ğ¡ğšğğ¨ğ°ğ«ğ¨ğœğ¤ğğ­/ğ‹ğ¨ğ¨ğ§ æ ¼å¼
â˜‘ï¸ æä¾›è¯´æ˜ 1âƒ£ï¸ ä¸­çš„å¯é€‰ä¸ªæ€§åŒ–å‚æ•°(ç­›é€‰ã€é‡å‘½å ç­‰)
â· ğ—¿ğ—²ğ˜„ğ—¿ğ—¶ğ˜ğ—²(é‡å†™) & ğ—³ğ—¶ğ—¹ğ˜ğ—²ğ—¿(åˆ†æµ) çš„ è½¬æ¢ & ç­›é€‰ 
â˜‘ï¸ ç”¨äºç¦ç”¨/ä¿®æ”¹è¿œç¨‹å¼•ç”¨ä¸­æŸ(å‡ )é¡¹ ğ—¿ğ—²ğ˜„ğ—¿ğ—¶ğ˜ğ—²/ğ—µğ—¼ğ˜€ğ˜ğ—»ğ—®ğ—ºğ—²/ğ—³ğ—¶ğ—¹ğ˜ğ—²ğ—¿
â˜‘ï¸ ğ’ğ®ğ«ğ ğ/ğ‚ğ¥ğšğ¬ğ¡ ç±»å‹è§„åˆ™ ğ—¹ğ—¶ğ˜€ğ˜ ä¸ æ¨¡å— ğ¦ğ¨ğğ®ğ¥ğ çš„è§£æä½¿ç”¨
----------------------------------------------------------
0ï¸âƒ£ åœ¨ âŸ¦è®¢é˜…é“¾æ¥âŸ§ ååŠ  "#" ä½¿ç”¨, ä¸åŒå‚æ•°ç”¨ "&" è¿æ¥ 
âš ï¸ â˜ https://mysub.com#emoji=1&tfo=1&in=é¦™æ¸¯+å°æ¹¾
â– æœ¬åœ°èµ„æºç‰‡æ®µå¼•ç”¨, è¯·å°†å‚æ•°å¦‚ "#ğ—¶ğ—»=ğ˜…ğ˜…ğ˜…." å¡«å…¥æ–‡ä»¶ç¬¬ â‘  è¡Œ
â– ğŸš¦ æ”¯æŒä¸­æ–‡, "æ“ä½œ" ä»¥ä¸‹ç‰¹æ®Šå­—ç¬¦æ—¶è¯·å…ˆæ›¿æ¢ ğŸš¦
  âˆ "+"â‡’"%2B", ç©ºæ ¼â‡’"%20", "@"â‡’"%40", "&"â‡’"%26", "."â‡’"\."

1ï¸âƒ£ âŸ¦ğ¬ğğ«ğ¯ğğ« èŠ‚ç‚¹âŸ§ â  å‚æ•°è¯´æ˜:
â¦¿ emoji=1(å›½è¡Œè®¾å¤‡ç”¨2)/-1, æ·»åŠ /åˆ é™¤èŠ‚ç‚¹åå†…åœ°åŒºæ——å¸œ;
â¦¿ udp=1/-1, tfo=1/-1, åˆ†åˆ«å¼ºåˆ¶å¼€å¯(å…³é—­) ğ®ğğ©-ğ«ğğ¥ğšğ²/ğŸğšğ¬ğ­-ğ¨ğ©ğğ§;
â¦¿ tls13=1, cert=1, åˆ†åˆ«å¼€å¯ ğ­ğ¥ğ¬1.3 åŠ ğ­ğ¥ğ¬ è¯ä¹¦éªŒè¯(é»˜è®¤å…³é—­);
â¦¿ in, out, regex, regout åˆ†åˆ«ä¸º ä¿ç•™ã€åˆ é™¤ã€æ­£åˆ™ä¿ç•™ã€æ­£åˆ™åˆ é™¤ èŠ‚ç‚¹;
  â– in, out ä¸­å¤šå‚æ•°(é€»è¾‘"æˆ–")ç”¨ "+", é€»è¾‘"ä¸"ç”¨ "." è¡¨ç¤º;
  â– in/out/regex/regout å‡å¯¹èŠ‚ç‚¹çš„å®Œæ•´ä¿¡æ¯è¿›è¡ŒåŒ¹é…(ç±»å‹ã€ç«¯å£ã€åŠ å¯†ç­‰);
  â– ç¤ºèŒƒ: "in=é¦™æ¸¯.0\.2å€ç‡+å°æ¹¾&out=BGP&regex=iplc"
â¦¿ rename é‡å‘½å, "æ—§å@æ–°å", "å‰ç¼€@", "@åç¼€", ç”¨ "+" è¿æ¥å¤šä¸ªå‚æ•°;
  â– åˆ é™¤å­—æ®µ: "å­—æ®µ1.å­—æ®µ2â˜ ï¸", æƒ³åˆ é™¤ "." æ—¶ç”¨ "\." æ›¿ä»£
  â– ç¤ºèŒƒ: "rename=é¦™æ¸¯@ğ‡ğŠ+[ğ’ğ’]@+@[1ğ—]+æµé‡.0\.2â˜ ï¸"
  â– é»˜è®¤ emoji å…ˆç”Ÿæ•ˆ, å¦‚æƒ³è°ƒæ¢é¡ºåº, è¯·ç”¨ ğ—¿ğ—¿ğ—»ğ—®ğ—ºğ—² å‚æ•°
â¦¿ replace æ­£åˆ™æ›¿æ¢èŠ‚ç‚¹ä¸­å­—æ®µ, å¯ç”¨äºé‡å‘½å/æ›´æ”¹åŠ å¯†æ–¹å¼ç­‰
  â– replace=regex1@ğ˜€ğ˜ğ—¿1+regex2@ğ˜€ğ˜ğ—¿2
  â– replace=ğ—¿ğ—²ğ—´ğ—²ğ˜…1@ åˆ™ç­‰æ•ˆäº delreg å‚æ•°
â¦¿ å ä½ç¬¦ï¼Œå¯ç”¨äº rename/replace ç­‰æ“ä½œ
  â– $type0/1/2/3/4/5/6/7 å ä½ç¬¦ï¼Œå°†èŠ‚ç‚¹ç±»å‹(ss/ssr/vmess ç­‰)ä½œä¸ºå¯æ“ä½œå‚æ•°ï¼Œå¦‚
    âˆ rename=@|$type2
    âˆ æ ·å¼åˆ†åˆ«ä¸º "ğ¬ğ¬","ğ’ğ’","ğŸ…¢ğŸ…¢","ğŸ†‚ğŸ†‚","â“¢â“¢","ğŸ…‚ğŸ…‚","ğ•Šğ•Š","Ë¢Ë¢"
  â– $index0/1/2/3/4/5/6/7/8 å ä½ç¬¦ï¼Œå°†èŠ‚ç‚¹çš„åºå·ä½œä¸ºå¯æ“ä½œå‚æ•°ï¼Œå¦‚
    âˆ rename=@ã€Œ$index1ã€
    âˆ æ ·å¼åˆ†åˆ«ä¸º 1\â‘ \â¶\â“µ\ğŸ™\Â¹\â‚\ğŸ\ğŸ·
  â– $emoji1/2 å ä½ç¬¦, å°†emoji(ğŸ‡­ğŸ‡° ç­‰)ä½œä¸ºå¯æ“ä½œå‚æ•°
    âˆ rename=@ã€Œ$emoji1ã€
  â– $tag å ä½ç¬¦ï¼Œå°†è®¢é˜…çš„ tag ä½œä¸ºå¯æ“ä½œå‚æ•°ï¼Œå¦‚
    âˆ å¯æ¥æ•°å­—ä»¥å•ç‹¬ç»™ tag æ·»åŠ å­—æ¯/æ•°å­—æ ·å¼
    âˆ rename=@ã€Œ$tag34ã€, æ ·å¼åŒä¸‹è¾¹çš„ ptn/npt
â¦¿ ptn=1-8, å°†èŠ‚ç‚¹åè‹±æ–‡æ›¿æ¢æˆæ ·å¼ â‡’ ğŸ…°/ğŸ„°/ğ€/ğ—®/ğ”¸/ğ•’/áµƒ/á´¬
â¦¿ npt=1-8, å°†èŠ‚ç‚¹åæ•°å­—æ›¿æ¢æˆæ ·å¼ â‡’ â‘ \â¶\â“µ\ğŸ™\Â¹\â‚\ğŸ\ğŸ·
â¦¿ delreg, åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥åˆ é™¤ "èŠ‚ç‚¹å" ä¸­çš„å­—æ®µ(âš ï¸ æ…ç”¨)
â¦¿ sort=1/-1/x/å‚æ•°è§„åˆ™, æŒ‰èŠ‚ç‚¹å æ­£/é€†/éšæœº/å‚æ•°è§„åˆ™ æ’åº
  â– å‚æ•°è§„åˆ™æ˜¯æ­£åˆ™è¡¨è¾¾å¼æˆ–ç®€å•å…³é”®è¯, ç”¨"<" æˆ– ">" è¿æ¥
  â– sort=ğŸ‡­ğŸ‡°>ğŸ‡¸ğŸ‡¬>ğŸ‡¯ğŸ‡µ>ğŸ‡ºğŸ‡¸ , é å‰æ’åº
  â– sort=IEPL<IPLC<BGP , é åæ’åº
â¦¿ info=1, å¼€å¯é€šçŸ¥æç¤ºæœºåœº âœˆï¸ æµé‡ä¿¡æ¯(å¦‚æœ‰æä¾›);
â¦¿ del=1, æœ‰é‡åèŠ‚ç‚¹æ—¶ç”¨æ­¤å‚æ•°åˆ é™¤é‡å¤èŠ‚ç‚¹(é»˜è®¤æ”¹åä¿ç•™)
â¦¿ âŸ¦è¿›é˜¶å‚æ•°âŸ§: ğ˜€ğ—³ğ—¶ğ—¹ğ˜ğ—²ğ—¿/ğ˜€ğ—¿ğ—²ğ—»ğ—®ğ—ºğ—², ä¼ å…¥ä¸€æ®µ base64 ç¼–ç çš„è„šæœ¬, å¯ç”¨äºæ›´ä¸ºå¤æ‚çš„[è¿‡æ»¤/é‡å‘½å] éœ€æ±‚
  â– è¯´æ˜: https://github.com/KOP-XIAO/QuantumultX/pull/9

2âƒ£ï¸ âŸ¦ğ«ğğ°ğ«ğ¢ğ­ğ é‡å†™âŸ§/âŸ¦ğŸğ¢ğ¥ğ­ğğ« åˆ†æµâŸ§ â  å‚æ•°è¯´æ˜:
â¦¿ in, out, æ ¹æ®å…³é”®è¯ ä¿ç•™/ç¦ç”¨ ç›¸å…³åˆ†æµã€é‡å†™è§„åˆ™;
â¦¿ inhn, outhn, â€œä¿ç•™/åˆ é™¤â€ä¸»æœºå(ğ’‰ğ’ğ’”ğ’•ğ’ğ’‚ğ’ğ’†);
  â– ç¤ºèŒƒ: ç¦ç”¨ "æ·˜å®æ¯”ä»·" åŠ "weibo" çš„ js åŒä¸»æœºå
  ğ¡ğ­ğ­ğ©ğ¬://ğ¦ğ²ğ¥ğ¢ğ¬ğ­#ğ’ğ’–ğ’•=tb_price.js+wb_ad.js&outhn=weibo
â¦¿ regex/regout, æ­£åˆ™ä¿ç•™/åˆ é™¤, è¯·è‡ªè¡ŒæŠ˜è…¾æ­£åˆ™è¡¨è¾¾å¼;
  â– å¯ä¸ in(hn)/out(hn) ä¸€èµ·ä½¿ç”¨ï¼Œin(hn)/out(hn) ä¼šä¼˜å…ˆæ‰§è¡Œ;
  â– å¯¹ ğ’‰ğ’ğ’”ğ’•ğ’ğ’‚ğ’ğ’† & ğ«ğğ°ğ«ğ¢ğ­ğ/ğŸğ¢ğ¥ğ­ğğ« åŒæ—¶ç”Ÿæ•ˆ(âš ï¸ æ…ç”¨)
â¦¿ policy å‚æ•°, ç”¨äºç›´æ¥æŒ‡å®šç­–ç•¥ç»„ï¼Œæˆ–ä¸º ğ’ğ®ğ«ğ ğ ç±»å‹ ğ—¿ğ˜‚ğ—¹ğ—²-ğ˜€ğ—²ğ˜ ç”Ÿæˆç­–ç•¥ç»„(é»˜è®¤"ğ’ğ¡ğšğ°ğ§"ç­–ç•¥ç»„);
â¦¿ pset=regex1@policy1+regex2@policy2, ä¸ºåŒä¸€åˆ†æµè§„åˆ™ä¸­ä¸åŒå…³é”®è¯(å…è®¸æ­£åˆ™è¡¨è¾¾å¼)æŒ‡å®šä¸åŒç­–ç•¥ç»„;
â¦¿ replace å‚æ•°, æ­£åˆ™æ›¿æ¢ ğŸğ¢ğ¥ğ­ğğ«/ğ«ğğ°ğ«ğ¢ğ­ğ å†…å®¹, regex@newregex;
  â– å°†æ·˜å®æ¯”ä»·ä¸­è„šæœ¬æ›¿æ¢æˆ lite ç‰ˆæœ¬, tiktok ä¸­ JP æ¢æˆ KR
    âˆ replace=(price)(.*)@$1_lite$2+jp@kr 
â¦¿ dst=rewrite/filterï¼Œåˆ†åˆ«ä¸ºå°† ğ¦ğ¨ğğ®ğ¥ğ&ğ—¿ğ˜‚ğ—¹ğ—²-ğ˜€ğ—²ğ˜ è½¬æ¢æˆ é‡å†™/åˆ†æµ;
  â– âš ï¸ é»˜è®¤å°† ğ¦ğ¨ğğ®ğ¥ğ è½¬æ¢åˆ°é‡å†™, ğ—¿ğ˜‚ğ—¹ğ—²-ğ˜€ğ—²ğ˜ è½¬æˆåˆ†æµ
  â– âš ï¸ æŠŠ ğ—¿ğ˜‚ğ—¹ğ—²-ğ˜€ğ—²ğ˜ ä¸­ ğ®ğ«ğ¥-ğ«ğğ ğğ± è½¬æˆé‡å†™æ—¶, å¿…é¡»è¦åŠ  dst=rewrite;
  â– âš ï¸ æŠŠ ğ¦ğ¨ğğ®ğ¥ğ ä¸­çš„åˆ†æµè§„åˆ™è½¬æ¢æ—¶, å¿…é¡»è¦åŠ  dst=filter
â¦¿ cdn=1, å°† github è„šæœ¬çš„åœ°å€è½¬æ¢æˆå…ç¿»å¢™cdn.jsdelivr.net
â¦¿ fcr=1/2, ä¸ºåˆ†æµè§„åˆ™æ·»åŠ  force-cellular/multi-interface å‚æ•°ï¼Œå¼ºåˆ¶ç§»åŠ¨æ•°æ®/æ··åˆæ•°æ®
â¦¿ via=æ¥å£, ä¸ºåˆ†æµè§„åˆ™æ·»åŠ  via-interface å‚æ•°, 0 è¡¨ç¤º via-interface=%TUN%

3âƒ£ï¸ å…¶ä»–å‚æ•°
â¦¿ é€šçŸ¥å‚æ•° ntf=0/1, ç”¨äº å…³é—­/æ‰“å¼€ èµ„æºè§£æå™¨çš„æç¤ºé€šçŸ¥
  â– ğ—¿ğ—²ğ˜„ğ—¿ğ—¶ğ˜ğ—²/ğ—³ğ—¶ğ—¹ğ˜ğ—²ğ—¿ é»˜è®¤â€œå¼€å¯â€é€šçŸ¥æç¤º, ä»¥é˜²è§„åˆ™è¯¯åˆ é™¤
  â– ğ˜€ğ—²ğ—¿ğ˜ƒğ—²ğ—¿ èµ„æºè§£æåˆ™é»˜è®¤â€å…³é—­â€œé€šçŸ¥æç¤º
â¦¿ ç±»å‹å‚æ•° type=domain-set/rule/module/list/nodes
  â– å½“è§£æå™¨æœªèƒ½æ­£ç¡®è¯†åˆ«ç±»å‹æ—¶, å¯å°è¯•ä½¿ç”¨æ­¤å‚æ•°å¼ºåˆ¶æŒ‡å®š
â¦¿ éšè—å‚æ•° hide=1, éšè—ç­›é™¤çš„åˆ†æµ/é‡å†™ï¼Œé»˜è®¤æ–¹å¼ä¸ºç¦ç”¨
----------------------------------------------------------
*/

/**
* ä½¿ç”¨è¯´æ˜ï¼Œ
0ï¸âƒ£ åœ¨QuantumultX é…ç½®æ–‡ä»¶ä¸­[general] éƒ¨åˆ†ï¼ŒåŠ å…¥ 
resource_parser_url = https://raw.githubusercontent.com/KOP-XIAO/QuantumultX/master/Scripts/resource-parser.js
âš ï¸âš ï¸å¦‚æç¤º"æ²¡æœ‰è‡ªå®šä¹‰è§£æå™¨"ï¼Œè¯·é•¿æŒ‰å³ä¸‹è§’å›¾æ ‡åç‚¹å‡»å·¦ä¾§åˆ·æ–°æŒ‰é’®ï¼Œæ›´æ–°èµ„æºï¼Œåå°é€€å‡º appï¼Œç›´åˆ°å‡ºç°è§£æå™¨è¯´æ˜

------------------------------
*/


//beginning è§£æå™¨æ­£å¸¸ä½¿ç”¨ï¼Œèª¿è©¦è¨»é‡‹æ­¤éƒ¨åˆ†

let [link0, content0, subinfo] = [$resource.link, $resource.content, $resource.info]
const subtag = $resource.tag != undefined ? $resource.tag : "";
////// é raw é“¾æ¥çš„æ²™é›•æƒ…å½¢
content0 = content0.indexOf("DOCTYPE html") != -1 && link0.indexOf("github.com") != -1 ? ToRaw(content0) : content0 ;
//ends æ­£å¸¸ä½¿ç”¨éƒ¨åˆ†ï¼Œèª¿è©¦è¨»é‡‹æ­¤éƒ¨åˆ†


var para = /^(http|https)\:\/\//.test(link0) ? link0 : content0.split("\n")[0];
var para1 = para.slice(para.indexOf("#") + 1).replace(/\$type/g,"node_type_para_prefix").replace(/\$emoji/g,"node_emoji_flag_prefix").replace(/\$tag/g,"node_tag_prefix").replace(/\$index/g,"node_index_prefix") //é˜²æ­¢å‚æ•°ä¸­å…¶å®ƒä½ç½®ä¹Ÿå­˜åœ¨"#"
var mark0 = para.indexOf("#") != -1 ? true : false; //æ˜¯å¦æœ‰åƒæ•¸éœ€è¦è§£æ
var Pinfo = mark0 && para1.indexOf("info=") != -1 ? para1.split("info=")[1].split("&")[0] : 0;
var ntf_flow = 0;
//å¸¸ç”¨é‡
const Base64 = new Base64Code();
const escapeRegExp = str => str.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, '\\$&'); //å¤„ç†ç‰¹æ®Šç¬¦å·ä»¥ä¾¿æ­£åˆ™åŒ¹é…ä½¿ç”¨
var link1 = link0.split("#")[0]
const qxpng = "https://raw.githubusercontent.com/crossutility/Quantumult-X/master/quantumult-x.png" // server sub-info link
const subinfo_link = { "open-url": "https://t.me/QuanX_API", "media-url": "https://shrtm.nu/ebAr" };
const subinfo_link1 = { "open-url": link1, "media-url": "https://shrtm.nu/uo13" } // server sub-info link(fake-nodes)
const rwrite_link = { "open-url": link1, "media-url": "https://shrtm.nu/x3o2" } // rewrite filter link
const rwhost_link = { "open-url": link1, "media-url": "https://shrtm.nu/0n5J" } // hostname filter link
const rule_link = { "open-url": link1, "media-url": "https://shrtm.nu/cpHD" } // rule filter link
const nan_link = { "open-url": link1, "media-url": qxpng } // nan error link
const bug_link = { "open-url": "https://t.me/ShawnKOP_bot", "media-url": "https://shrtm.nu/obcB" } // bug link
const sub_link = { "open-url": link1, "media-url": "https://shrtm.nu/ebAr" } // server link


SubFlow() //æµé‡é€šçŸ¥


// å‚æ•°è·å–
var Pin0 = mark0 && para1.indexOf("in=") != -1 ? (para1.split("in=")[1].split("&")[0].split("+")).map(decodeURIComponent) : null;
var Pout0 = mark0 && para1.indexOf("out=") != -1 ? (para1.split("out=")[1].split("&")[0].split("+")).map(decodeURIComponent) : null;
var Psfilter = mark0 && para1.indexOf("sfilter=") != -1 ? Base64.decode(para1.split("sfilter=")[1].split("&")[0]) : null; // script filter
var Preg = mark0 && para1.indexOf("regex=") != -1 ? decodeURIComponent(para1.split("regex=")[1].split("&")[0]).replace(/\ï¼Œ/g,",") : null; //serveræ­£åˆ™è¿‡æ»¤å‚æ•°
var Pregout = mark0 && para1.indexOf("regout=") != -1 ? decodeURIComponent(para1.split("regout=")[1].split("&")[0]).replace(/\ï¼Œ/g,",") : null; //serveræ­£åˆ™åˆ é™¤å‚æ•°
var Pregdel = mark0 && para1.indexOf("delreg=") != -1 ? decodeURIComponent(para1.split("delreg=")[1].split("&")[0]).replace(/\ï¼Œ/g,",") : null; // æ­£åˆ™åˆ é™¤å‚æ•°
var Phin0 = mark0 && para1.indexOf("inhn=") != -1 ? (para1.split("inhn=")[1].split("&")[0].split("+")).map(decodeURIComponent) : null; //hostname 
var Phout0 = mark0 && para1.indexOf("outhn=") != -1 ? (para1.split("outhn=")[1].split("&")[0].split("+")).map(decodeURIComponent) : null; //hostname
var Preplace = mark0 && para1.indexOf("replace=") != -1 ? para1.split("replace=")[1].split("&")[0] : null; //filter/rewrite æ­£åˆ™æ›¿æ¢
var Pemoji = mark0 && para1.indexOf("emoji=") != -1 ? para1.split("emoji=")[1].split("&")[0] : null;
var Pdbg = mark0 && para1.indexOf("dbg=") != -1 ? para1.split("dbg=")[1].split("&")[0] : null;
var Pudp0 = mark0 && para1.indexOf("udp=") != -1 ? para1.split("udp=")[1].split("&")[0] : 0;
var Ptfo0 = mark0 && para1.indexOf("tfo=") != -1 ? para1.split("tfo=")[1].split("&")[0] : 0;
var Prname = mark0 && para1.indexOf("rename=") != -1 ? para1.split("rename=")[1].split("&")[0].split("+") : null;
var Psrename = mark0 && para1.indexOf("srename=") != -1 ? Base64.decode(para1.split("srename=")[1].split("&")[0]) : null; // script rename
var Prrname = mark0 && para1.indexOf("rrname=") != -1 ? para1.split("rrname=")[1].split("&")[0].split("+") : null;
var Psuffix = mark0 && para1.indexOf("suffix=") != -1 ? para1.split("suffix=")[1].split("&")[0] : 0;
var Ppolicy = mark0 && para1.indexOf("policy=") != -1 ? decodeURIComponent(para1.split("policy=")[1].split("&")[0]) : "Shawn";
var Ppolicyset = mark0 && para1.indexOf("pset=") != -1 ? decodeURIComponent(para1.split("pset=")[1].split("&")[0]) : "";
var Pcert0 = mark0 && para1.indexOf("cert=") != -1 ? para1.split("cert=")[1].split("&")[0] : 0;
var Psort0 = mark0 && para1.indexOf("sort=") != -1 ? para1.split("sort=")[1].split("&")[0] : 0;
var PsortX = mark0 && para1.indexOf("sortx=") != -1 ? para1.split("sortx=")[1].split("&")[0] : 0;
var PTls13 = mark0 && para1.indexOf("tls13=") != -1 ? para1.split("tls13=")[1].split("&")[0] : 0;
var Pntf0 = mark0 && para1.indexOf("ntf=") != -1 ? para1.split("ntf=")[1].split("&")[0] : 2;
var Phide = mark0 && para1.indexOf("hide=") != -1 ? para1.split("hide=")[1].split("&")[0] : 0;
var Pb64 = mark0 && para1.indexOf("b64=") != -1 ? para1.split("b64=")[1].split("&")[0] : 0;
var emojino = [" 0ï¸âƒ£ ", " 1âƒ£ï¸ ", " 2âƒ£ï¸ ", " 3âƒ£ï¸ ", " 4âƒ£ï¸ ", " 5âƒ£ï¸ ", " 6âƒ£ï¸ ", " 7âƒ£ï¸ ", " 8âƒ£ï¸ ", " 9âƒ£ï¸ ", " ğŸ”Ÿ "]
var pfi = Pin0 ? "in=" + Pin0.join(", ") + ",  " : ""
var pfo = Pout0 ? "out=" + Pout0.join(", ") : ""
var pfihn = Phin0 ? "inhn=" + Phin0.join(", ") + ",  " : ""
var pfohn = Phout0 ? "outhn=" + Phout0.join(", ") : ""
var Pcnt =  para1.indexOf("cnt=") != -1 ? para1.split("cnt=")[1].split("&")[0] : 0;
var Pcap = para1.indexOf("cap=") != -1 ? para1.split("cap=")[1].split("&")[0] : "";
var Pptn = para1.indexOf("ptn=") != -1 ? para1.split("ptn=")[1].split("&")[0] : ""; //èŠ±å¼è‹±æ–‡å­—ç¬¦
var Pnptn = para1.indexOf("npt=") != -1 ? para1.split("npt=")[1].split("&")[0] : ""; //èŠ±å¼æ•°å­—
var Pcdn = para1.indexOf("cdn=") != -1 ? para1.split("cdn=")[1].split("&")[0] : "";
let [flow, exptime, errornode, total] = "";
var Pdel = mark0 && para1.indexOf("del=") != -1 ? para1.split("del=")[1].split("&")[0] : 0; //åˆ é™¤é‡å¤èŠ‚ç‚¹
var typeU = para1.indexOf("type=") != -1 ? para1.split("type=")[1].split("&")[0] : "";
var Pfcr = para1.indexOf("fcr=") != -1 ? para1.split("fcr=")[1].split("&")[0] : ""; // force-cellular å‚æ•°
var Pvia = para1.indexOf("via=") != -1 ? para1.split("via=")[1].split("&")[0] : ""; // via-interface å‚æ•°

var typeQ = $resource.type? $resource.type:"unsupported"   //è¿”å› field ç±»å‹å‚æ•°



//èŠ±æ¼¾å­— pattern
var pat=[]
pat[0] = ["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","k","r","s","t","u","v","w","x","y","z"]
pat[1] = ["ğŸ…°","ğŸ…±","ğŸ…²","ğŸ…³","ğŸ…´","ğŸ…µ","ğŸ…¶","ğŸ…·","ğŸ…¸","ğŸ…¹","ğŸ…º","ğŸ…»","ğŸ…¼","ğŸ…½","ğŸ…¾","ğŸ…¿","ğŸ…º","ğŸ†","ğŸ†‚","ğŸ†ƒ","ğŸ†„","ğŸ†…","ğŸ††","ğŸ†‡","ğŸ†ˆ","ğŸ†‰"]
pat[2] = ["ğŸ„°","ğŸ„±","ğŸ„²","ğŸ„³","ğŸ„´","ğŸ„µ","ğŸ„¶","ğŸ„·","ğŸ„¸","ğŸ„¹","ğŸ„º","ğŸ„»","ğŸ„¼","ğŸ„½","ğŸ„¾","ğŸ„¿","ğŸ„º","ğŸ…","ğŸ…‚","ğŸ…ƒ","ğŸ…„","ğŸ……","ğŸ…†","ğŸ…‡","ğŸ…ˆ","ğŸ…‰"]
pat[3] = ["ğ€","ğ","ğ‚","ğƒ","ğ„","ğ…","ğ†","ğ‡","ğˆ","ğ‰","ğŠ","ğ‹","ğŒ","ğ","ğ","ğ","ğŠ","ğ‘","ğ’","ğ“","ğ”","ğ•","ğ–","ğ—","ğ˜","ğ™"]
pat[4] = ["ğ—®","ğ—¯","ğ—°","ğ—±","ğ—²","ğ—³","ğ—´","ğ—µ","ğ—¶","ğ—·","ğ—¸","ğ—¹","ğ—º","ğ—»","ğ—¼","ğ—½","ğ—¸","ğ—¿","ğ˜€","ğ­","ğ˜‚","ğ˜ƒ","ğ˜„","ğ˜…","ğ˜†","ğ˜‡"]
pat[5] = ["ğ”¸","ğ”¹","â„‚","ğ”»","ğ”¼","ğ”½","ğ”¾","â„","ğ•€","ğ•","ğ•‚","ğ•ƒ","ğ•„","â„•","ğ•†","â„™","ğ•‚","â„","ğ•Š","ğ•‹","ğ•Œ","ğ•","ğ•","ğ•","ğ•","â„¤"]
pat[6] = ["ğ•’","ğ•“","ğ•”","ğ••","ğ•–","ğ•—","ğ•˜","ğ•™","ğ•š","ğ•›","ğ•œ","ğ•","ğ•","ğ•Ÿ","ğ• ","ğ•¡","ğ•œ","ğ•£","ğ•¤","ğ•¥","ğ•¦","ğ•§","ğ•¨","ğ•©","ğ•ª","ğ•«"]
pat[7] = ["áµƒ","áµ‡","á¶œ","áµˆ","áµ‰","á¶ ","áµ","Ê°","â±","Ê²","áµ","Ë¡","áµ","â¿","áµ’","áµ–","áµ’âƒ’","Ê³","Ë¢","áµ—","áµ˜","áµ›","Ê·","Ë£","Ê¸","á™†"]
pat[8] = ["á´¬","á´®","á’¼","á´°","á´±","á¶ ","á´³","á´´","á´µ","á´¶","á´·","á´¸","á´¹","á´º","á´¼","á´¾","á´¼Ì´","á´¿","Ë¢","áµ€","áµ","áµ›","áµ‚","Ë£","Ê¸","á™†"]

// èŠ±å¼æ•°å­—
var patn=[]
patn[0] = ["0","1","2","3","4","5","6","7","8","9"]
patn[1] = [ 'â“ª', 'â‘ ', 'â‘¡', 'â‘¢', 'â‘£', 'â‘¤', 'â‘¥', 'â‘¦', 'â‘§', 'â‘¨' ]
patn[2] = [ 'â“ª', 'â¶', 'â·', 'â¸', 'â¹', 'âº', 'â»', 'â¼', 'â½', 'â¾' ]
patn[3] = [ 'â“ª', 'â“µ', 'â“¶', 'â“·', 'â“¸', 'â“¹', 'â“º', 'â“¼', 'â“»', 'â“½' ]
patn[4] = [ 'ğŸ˜', 'ğŸ™', 'ğŸš', 'ğŸ›', 'ğŸœ', 'ğŸ', 'ğŸ', 'ğŸŸ', 'ğŸ ', 'ğŸ¡' ]
patn[5] = [ 'â°', 'Â¹', 'Â²', 'Â³', 'â´', 'âµ', 'â¶', 'â·', 'â¸', 'â¹' ]
patn[6] = [ 'â‚€', 'â‚', 'â‚‚', 'â‚ƒ', 'â‚„', 'â‚…', 'â‚†', 'â‚‡', 'â‚ˆ', 'â‚‰' ]
patn[7] = ["ğŸ","ğŸ","ğŸ","ğŸ‘","ğŸ’","ğŸ“","ğŸ”","ğŸ–","ğŸ—"]
patn[8] = ["ğŸ¶","ğŸ·","ğŸ¸","ğŸ¹","ğŸº","ğŸ»","ğŸ¼","ğŸ½","ğŸ¾","ğŸ¿"]


var type0=""
//flag=1,2,3åˆ†åˆ«ä¸º serverã€rewriteã€rule ç±»å‹
var flag = 1

function Parser() {
  type0 = Type_Check(content0); //  ç±»å‹åˆ¤æ–­
  //$notify(type0)
  if (type0 != "web" && type0 != "wrong-field"){
    try {
      //$notify(type0,"hh")
      if (Pdbg){
        $notify(link0,type0,content0)
      }
      total = ResourceParse();
      
    } catch (err) {
      $notify("âŒ è§£æå‡ºç°é”™è¯¯", "âš ï¸ è¯·ç‚¹å‡»å‘é€é“¾æ¥åé¦ˆ", err, bug_link);
    }
  } else if (type0 == "wrong-field"){
    //$notify(type0+"ss")
    $notify("âŒ è§£æç±»å‹ä¸ç›®æ ‡ç±»å‹"+" ã€Œ"+typeQ+" ã€ä¸ç¬¦", "âš ï¸ è¯·è‡ªè¡Œæ£€æŸ¥é“¾æ¥å†…å®¹ï¼Œæˆ–ç‚¹å‡»é€šçŸ¥åé¦ˆ", $resource.link, bug_link)
    total=""
  } else {
    total=""
  }
    //$notify("","",total)
    $done({ content: total });
}

if (typeof($resource)!=="undefined") {
  Parser()
  $done({ content: total })
}


/**
# ä»¥ä¸‹ä¸ºå…·ä½“çš„ function

*/

function ParseUnknown(cnt){
  try {
    cnt = JSON.parse(cnt)
    if(cnt) {
      $notify("âš ï¸ é“¾æ¥è¿”å›å†…å®¹å¹¶éæœ‰æ•ˆè®¢é˜…"+ "âŸ¦" + subtag + "âŸ§","â‰ï¸ è¯·è‡ªè¡Œæ£€æŸ¥åŸå§‹é“¾æ¥ï¼Œè¿”å›å†…å®¹ ğŸ‘‡ï¸ğŸ‘‡ï¸",JSON.stringify(cnt), bug_link)
    }
    
  } catch(err) {
    $notify("ğŸ˜­ æœªèƒ½è¯†åˆ«è¯¥è®¢é˜…æ ¼å¼ï¼š  " + "âŸ¦" + subtag + "âŸ§",  "âš ï¸ å°†ç›´æ¥å¯¼å…¥Quantumult X \n å¦‚è®¤ä¸ºæ˜¯ BUG, è¯·ç‚¹é€šçŸ¥è·³è½¬åé¦ˆ", "é“¾æ¥è¿”å›å†…å®¹:\n"+cnt, bug_link);
  }
}



function ResourceParse() {
  //é¢„å¤„ç†ï¼Œåˆ†æµ/é‡å†™ç­‰å¤„ç†å®Œæˆ
  if (type0 == "Subs-B64Encode") {
    total = Subs2QX(Base64.decode(content0), Pudp0, Ptfo0, Pcert0, PTls13);
  } else if (type0 == "Subs") {
    total = Subs2QX(content0, Pudp0, Ptfo0, Pcert0, PTls13);
  } else if (type0 == "QuanX" || type0 == "Clash" || type0 == "Surge") {
    total = Subs2QX(isQuanX(content0).join("\n"), Pudp0, Ptfo0, Pcert0, PTls13);
  } else if (type0 == "sgmodule") { // surge module æ¨¡å—/å« url-regex çš„ rule-set
    flag = 2 
    total = SGMD2QX(content0) // è½¬æ¢ 
    total = Rewrite_Filter(total, Pin0, Pout0,Preg,Pregout); // ç­›é€‰è¿‡æ»¤
    if (Preplace) { total = ReplaceReg(total, Preplace) }
    if (Pcdn) {total = CDN(total)
    } else { total = total.join("\n")}
  } else if (type0 == "rewrite") { // rewrite ç±»å‹
    flag = 2;
    total = Rewrite_Filter(isQuanXRewrite(content0.split("\n")), Pin0, Pout0,Preg,Pregout);
    if (Preplace) { total = ReplaceReg(total, Preplace) }
    if (Pcdn) {total = CDN(total)
    } else {total = total.join("\n")}
  } else if (type0 == "Rule") {  // rule ç±»å‹, å·²å¤„ç†å®Œæ¯•
    flag = 3;
    total = Rule_Handle(content0.split("\n"), Pout0, Pin0).filter(Boolean);
    if (Preg && total.length!=0) { // æ­£åˆ™ç­›é€‰è§„åˆ™ filter
    total = total.map(Regex).filter(Boolean) 
    RegCheck(total, "åˆ†æµå¼•ç”¨", "regex", Preg)
  } 
    if (Pregout && total.length!=0) { // æ­£åˆ™åˆ é™¤è§„åˆ™ filter
    total = total.map(RegexOut).filter(Boolean)
    RegCheck(total, "åˆ†æµå¼•ç”¨", "regout", Pregout)
  }
    if (Preplace) { total = ReplaceReg(total, Preplace) }
    if (Ppolicyset) {total = policy_sets(total, Ppolicyset)}
    total = total.join("\n")
  } else if (content0.trim() == "") {
    $notify("â€¼ï¸ å¼•ç”¨" + "âŸ¦" + subtag + "âŸ§" + " è¿”å›å…§å®¹ä¸ºç©º", "â‰ï¸ ç‚¹é€šçŸ¥è·³è½¬ä»¥ç¡®è®¤é“¾æ¥æ˜¯å¦å¤±æ•ˆ", para.split("#")[0], nan_link);
    flag = 0;
  } else if (type0 == "unknown") {
    ParseUnknown(content0)
    flag = -1;
  }
  
  //å¼€å§‹å¤„ç†
  if (flag == 1) { //server ç±»å‹ç»Ÿä¸€å¤„ç†
    total = isQuanX(total.filter(Boolean).join("\n"))
    if (Pinfo == 1 && ntf_flow == 0) { //å‡èŠ‚ç‚¹ç±»å‹çš„æµé‡é€šçŸ¥
      flowcheck(total)
    }
    if (Pin0 || Pout0) { total = Filter(total, Pin0, Pout0) } // in & out 
    if (Preg) { total = total.map(Regex).filter(Boolean)  // regex
      RegCheck(total, "èŠ‚ç‚¹è®¢é˜…", "regex", Preg)} 
    if (Pregout) { total = total.map(RegexOut).filter(Boolean)  // regex out
      RegCheck(total, "èŠ‚ç‚¹è®¢é˜…", "regout", Pregout)} 
    if (Psfilter) { total = FilterScript(total, Psfilter) }
    if (Prrname) {
      Prn = Prrname;
      total = total.map(Rename);
    }
    if (Pemoji) { total = emoji_handle(total, Pemoji); }
    if (Pregdel) {
      delreg = Pregdel
      total = total.map(DelReg)
    }
    if (Preplace) { // server ç±»å‹ä¹Ÿå¯ç”¨ replace å‚æ•°è¿›è¡Œé‡å‘½åæ“ä½œ
      total = ReplaceReg(total, Preplace)
    }
    if (Prname) {
      Prn = Prname;
      total = total.map(Rename);
    }
    if (Psrename) { total = RenameScript(total, Psrename) }
    if (total.length > 0){
      if (Psuffix==1 || Psuffix==-1) {total = Psuffix == 1? total.map(type_suffix):total.map(type_prefix)
      }
      total = total.map(type_handle).map(emoji_prefix_handle).map(tag_handle) //å„ç±»èŠ‚ç‚¹åæ“ä½œ
      if (Psort0) { //æ’åºæ“ä½œ
        total = QXSort(total, Psort0);
      }
      total = para1.indexOf("node_index_prefix")!=-1 ?index_handle(total):total // èŠ‚ç‚¹åºå·æ“ä½œ
      total = TagCheck_QX(total).join("\n") //èŠ‚ç‚¹åæ£€æŸ¥
      if (Pcnt == 1) {$notify("è§£æåæœ€ç»ˆè¿”å›å†…å®¹" , "èŠ‚ç‚¹æ•°é‡: " +total.split("\n").length, total)}
      total = Base64.encode(total) //å¼ºåˆ¶èŠ‚ç‚¹ç±»å‹ base64 åŠ å¯†åå†å¯¼å…¥ Quantumult X
      $done({ content: total });
    } else {
      $notify("â“â“ å‹æƒ…æç¤º âŸ "+ "âŸ¦" + subtag + "âŸ§", "âš ï¸âš ï¸ è§£æåæ— æœ‰æ•ˆå†…å®¹", "ğŸš¥ğŸš¥ è¯·è‡ªè¡Œæ£€æŸ¥ç›¸å…³å‚æ•°, æˆ–è€…ç‚¹å‡»é€šçŸ¥è·³è½¬åé¦ˆ", bug_link)
      total = errornode
      $done({ content: errornode })
    }
  } else if (flag == 0){ //ç©º/é”™è¯¯ç±»å‹
    total = errornode
    $done({ content: errornode })
  } else if (flag == -1){ //æœªçŸ¥ç±»å‹
    total = content0
    $done({ content: content0 })
  } 
  if (Pcnt == 1 && flag !=1) {$notify("è§£æåæœ€ç»ˆè¿”å›å†…å®¹" , "æ€»æ•°é‡ï¼š " +total.split("\n").length, total)}
  return total
  
}

//å“åº”å¤´æµé‡å¤„ç†éƒ¨åˆ†
function SubFlow() {
  if (Pinfo == 1 && subinfo) {
    var sinfo = subinfo.replace(/ /g, "").toLowerCase();
    var total = "æ€»æµé‡: " + (parseFloat(sinfo.split("total=")[1].split(",")[0]) / (1024 ** 3)).toFixed(2) + "GB";
    var usd = "å·²ç”¨æµé‡: " + ((parseFloat(sinfo.indexOf("upload")!=-1?sinfo.split("upload=")[1].split(",")[0]:"0") + parseFloat(sinfo.split("download=")[1].split(",")[0])) / (1024 ** 3)).toFixed(2) + "GB"
    var left = "å‰©ä½™æµé‡: " + ((parseFloat(sinfo.split("total=")[1].split(",")[0]) / (1024 ** 3)) - ((parseFloat(sinfo.indexOf("upload")!=-1?sinfo.split("upload=")[1].split(",")[0]:"0") + parseFloat(sinfo.split("download=")[1].split(",")[0])) / (1024 ** 3))).toFixed(2) + "GB"
    if (sinfo.indexOf("expire=") != -1) {
      var epr = new Date(parseFloat(sinfo.split("expire=")[1].split(",")[0]) * 1000);
      var year = epr.getFullYear();  // è·å–å®Œæ•´çš„å¹´ä»½(4ä½,1970)
      var mth = epr.getMonth() + 1 < 10 ? '0' + (epr.getMonth() + 1) : (epr.getMonth() + 1);  // è·å–æœˆä»½(0-11,0ä»£è¡¨1æœˆ,ç”¨çš„æ—¶å€™è®°å¾—åŠ ä¸Š1)
      var day = epr.getDate() < 10 ? "0" + (epr.getDate()) : epr.getDate();
      epr = "è¿‡æœŸæ—¶é—´: " + year + "-" + mth + "-" + day
    } else {
      epr = ""; //"è¿‡æœŸæ—¶é—´: âœˆï¸ æœªæä¾›è©²ä¿¡æ¯" //æ²¡è¿‡æœŸæ—¶é—´çš„æ˜¾ç¤ºè®¢é˜…é“¾æ¥
    }
    var message = total + "\n" + usd + ", " + left;
    ntf_flow = 1;
    $notify("æµé‡ä¿¡æ¯: âŸ¦" + subtag + "âŸ§", epr, message, subinfo_link)
  }
//  } else if (Pinfo ==1){
//    $notify("æµé‡ä¿¡æ¯: âŸ¦" + subtag + "âŸ§", "", "âš ï¸ è¯¥è®¢é˜…é“¾æ¥æœªè¿”å›ä»»ä½•æµé‡ä¿¡æ¯", subinfo_link)
//  }
}

//flowcheck-fake-server
function flowcheck(cnt) {
    for (var i = 0; i < cnt.length; i++) {
        var item = cnt[i];
        var nl = item.slice(item.indexOf("tag"))
        var nm = nl.slice(nl.indexOf("=") + 1)
        if (item.indexOf("å‰©ä½™æµé‡") != -1) {
            flow = nm
        } else if (item.indexOf("æœŸæ—¶é—´") != -1) {
            exptime = nm
        }
    }
  flow = flow? flow:"âš ï¸ è¯¥è®¢é˜…æœªè¿”å›ä»»ä½•æµé‡ä¿¡æ¯"
  exptime = exptime? exptime:"âš ï¸ è¯¥è®¢é˜…æœªè¿”å›å¥—é¤æ—¶é—´ä¿¡æ¯"
    if (flow != "") { $notify("æµé‡ä¿¡æ¯: âŸ¦" + subtag + "âŸ§", flow, exptime, subinfo_link1) }
}

// regex åçš„æ£€æŸ¥
function RegCheck(total, typen, paraname,regpara) {
	if(total.length == 0){ 
		$notify("â€¼ï¸ " + typen + "  âŸ " + "âŸ¦" + subtag + "âŸ§", "â›”ï¸ ç­›é€‰æ­£åˆ™: " + paraname + "=" + regpara, "âš ï¸ ç­›é€‰åå‰©ä½™é¡¹ä¸º 0ï¸âƒ£ , è¯·æ£€æŸ¥æ­£åˆ™å‚æ•°åŠåŸå§‹é“¾æ¥", nan_link)
	}else if((typen != "èŠ‚ç‚¹è®¢é˜…" && Pntf0 !=0) || (typen == "èŠ‚ç‚¹è®¢é˜…" && Pntf0 ==1)){
		var nolist = total.length <= 10 ? emojino[total.length] : total.length
		$notify("ğŸ¤– " + typen + "  âŸ " + "âŸ¦" + subtag + "âŸ§", "â›”ï¸ ç­›é€‰æ­£åˆ™: " + paraname + "=" + regpara, "âš ï¸ ç­›é€‰åå‰©ä½™ä»¥ä¸‹" + nolist + "ä¸ªåŒ¹é…é¡¹ \n â¨· " + total.join("\n â¨· "), sub_link)
	}
}
//åˆ¤æ–­è®¢é˜…ç±»å‹
function Type_Check(subs) {
    var type = "unknown"
    var RuleK = ["host,", "-suffix,", "domain,", "-keyword,", "ip-cidr,", "ip-cidr6,",  "geoip,", "user-agent,", "ip6-cidr,"];
    var DomainK = ["domain-set,"]
    var QuanXK = ["shadowsocks=", "trojan=", "vmess=", "http="];
    var SurgeK = ["=ss,", "=vmess,", "=trojan,", "=http,", "=custom,", "=https,", "=shadowsocks", "=shadowsocksr"];
    var ClashK = ["proxies:"]
    var SubK = ["dm1lc3M", "c3NyOi8v", "CnNzOi8", "dHJvamFu", "c3M6Ly", "c3NkOi8v", "c2hhZG93",,"aHR0c"];
    var RewriteK = [" url "]
    var SubK2 = ["ss://", "vmess://", "ssr://", "trojan://", "ssd://", "https://"];
    var ModuleK = ["[Script]", "[Rule]", "[URL Rewrite]", "[Map Local]", "[MITM]", "\nhttp-r"]
    var html = "DOCTYPE html"
    var subi = subs.replace(/ /g, "")
    const RuleCheck = (item) => subi.toLowerCase().indexOf(item) != -1;
    const NodeCheck = (item) => subi.toLowerCase().indexOf(item.toLowerCase()) != -1;
    const RewriteCheck = (item) => subs.indexOf(item) != -1;
    var subsn = subs.split("\n")
    if (subs.indexOf(html) != -1 && link0.indexOf("github.com" == -1)) {
      $notify("â€¼ï¸ è¯¥é“¾æ¥è¿”å›ç½‘é¡µå†…å®¹,æ— æœ‰æ•ˆè®¢é˜…"+ " âŸ " + "âŸ¦" + subtag + "âŸ§", "â‰ï¸ ç‚¹é€šçŸ¥è·³è½¬ä»¥ç¡®è®¤é“¾æ¥æ˜¯å¦å¤±æ•ˆ\n"+link0, subs, nan_link);
      type = "web";
    } else if (typeU == "nodes" ) {
      type = (typeQ == "unsupported" || typeQ =="server")? "Subs-B64Encode":"wrong-field"
    } else if (ClashK.some(NodeCheck) || typeU == "clash"){ // Clash ç±»å‹èŠ‚ç‚¹è½¬æ¢
      type = (typeQ == "unsupported" || typeQ =="server")? "Clash":"wrong-field";
      content0 = Clash2QX(subs)
    } else if ((/^hostname\s*\=|pattern\=/.test(subi) || RewriteK.some(RewriteCheck)) && !/\[(Proxy|filter_local)\]/.test(subs) && para1.indexOf("dst=filter")==-1 && subi.indexOf("securehostname") == -1 && !/module|nodes|rule/.test(typeU) ) {
      type = (typeQ == "unsupported" || typeQ =="rewrite")? "rewrite":"wrong-field" //Quantumult X ç±»å‹ rewrite/ Surge Script/
    } else if ( (((ModuleK.some(RewriteCheck) || para1.indexOf("dst=rewrite") != -1) && (para1.indexOf("dst=filter") == -1) && subs.indexOf("[Proxy]") == -1) || typeU == "module") && typeU != "nodes" && typeU != "rule" && typeQ !="filter") { // Surge ç±»å‹ module /rule-set(å«url-regex) ç±»å‹
      type = (typeQ == "unsupported" || typeQ =="rewrite")? "sgmodule" : "wrong-field"
    } else if (((RuleK.some(RuleCheck) && subs.indexOf(html) == -1 && !/\[(Proxy|server_local)\]/.test(subs)) || typeU == "rule" || para1.indexOf("dst=filter")!=-1) && typeU != "nodes") {
      type = (typeQ == "unsupported" || typeQ =="filter")? "Rule":"wrong-field";
    } else if ((DomainK.some(RuleCheck) || typeU == "domain-set") && subs.indexOf("[Proxy]") == -1 && typeU != "nodes") {
      type = (typeQ == "unsupported" || typeQ =="filter")? "Rule":"wrong-field";
      content0 = Domain2Rule(content0) // è½¬æ¢ domain-set
    } else if (subsn.length >= 1 && SubK2.some(NodeCheck) && !/\[(Proxy|filter_local)\]/.test(subs)) { //æœªb64åŠ å¯†çš„å¤šè¡ŒURI ç»„åˆè®¢é˜…
      type = (typeQ == "unsupported" || typeQ =="server"||typeQ =="uri") ? "Subs":"wrong-field"
    } else if (SubK.some(NodeCheck)) {  //b64åŠ å¯†çš„è®¢é˜…ç±»å‹
      type = (typeQ == "unsupported" || typeQ =="server")? "Subs-B64Encode":"wrong-field"
    } else if ((subi.indexOf("tag=") != -1 && QuanXK.some(NodeCheck) && !/\[(Proxy|filter_local)\]/.test(subs)) || typeU =="list") {
      type = (typeQ == "unsupported" || typeQ =="server")? "Subs":"wrong-field" // QuanX list
    } else if (subs.indexOf("[Proxy]") != -1) {
      type = (typeQ == "unsupported" || typeQ =="server")? "Surge":"wrong-field"; // Surge Profiles
      content0 = Surge2QX(content0).join("\n");
    } else if ((SurgeK.some(NodeCheck)  && !/\[(Proxy|filter_local)\]/.test(subs)) || typeU == "list") {
      type = (typeQ == "unsupported" || typeQ =="server")? "Subs":"wrong-field" // Surge proxy list
    } else if (subs.indexOf("[server_local]") != -1) {
      //type = "QuanX"  // QuanX Profile
      type = (typeQ == "unsupported" || typeQ =="server")? "Subs":"wrong-field"
    } else if (content0.indexOf("server") !=-1 && content0.indexOf("server_port") !=-1) { //SIP008
      //type = "QuanX"
      type = (typeQ == "unsupported" || typeQ =="server")? "Subs":"wrong-field"
      content0 = SIP2QuanX(content0)
    } 
  // ç”¨äºé€šçŸ¥åˆ¤æ–­ç±»å‹ï¼Œdebug
  if(typeU == "X"){
    $notify(type,"",content0)
  }
    return type
}

// æ£€æŸ¥èŠ‚ç‚¹åå­—(é‡å¤ä»¥åŠç©ºå)ç­‰QuanX ä¸å…è®¸çš„æƒ…å½¢ï¼Œä»¥åŠå¤šä¸ªç©ºæ ¼ç­‰â€œä¸è§„èŒƒâ€æ–¹å¼
function TagCheck_QX(content) {
  typefix = {"shadowsocks":["ğ¬ğ¬","ğ’ğ’","ğŸ…¢ğŸ…¢","ğŸ†‚ğŸ†‚","â“¢â“¢","ğŸ…‚ğŸ…‚","SS"],"shadowsocksr":["ğ¬ğ¬ğ«","ğ’ğ’ğ‘","ğŸ…¢ğŸ…¢ğŸ…¡","ğŸ†‚ğŸ†‚ğŸ†","â“¢â“¢â“¡","ğŸ…‚